<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Estrazione Giocatori Soccerverse</title>
</head>
<body>

  <h1>Estrazione giocatori senza agente</h1>
  
  <button onclick="startExtraction()">▶️ Avvia Estrazione</button>
  <button onclick="stopExtraction()">⏹️ Ferma</button>
  <button onclick="resetProgress()">🔄 Resetta</button>

  <div id="log" style="margin-top: 20px; white-space: pre-wrap;"></div>

  <script>
    let stopRequested = false;

    function log(message) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += message + "\n";
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function startExtraction() {
      stopRequested = false;
      let playerId = parseInt(localStorage.getItem('playerId')) || 1;

      async function processPlayer(id) {
        if (stopRequested) {
          log("🔁 Estrazione fermata a ID " + id);
          return;
        }

        try {
          // Sostituisci con il tuo proxy reale qui
          const response = await fetch(`https://your-proxy.com/players/detailed?player_id=${id}`);
          if (!response.ok) throw new Error("Errore nella risposta");

          const data = await response.json();

          if (data.agent === null) {
            log(`✅ Giocatore senza agente trovato! ID: ${id} | Nome: ${data.name}`);
            // Qui puoi anche salvarlo o aggiungerlo alla tua lista
          } else {
            log(`🚫 Giocatore con agente - ID: ${id}`);
          }

          // Salva il prossimo ID nel localStorage
          localStorage.setItem('playerId', id + 1);

          // Continua con il prossimo dopo breve pausa
          setTimeout(() => processPlayer(id + 1), 400);

        } catch (e) {
          log(`❌ Errore per ID ${id}: ${e.message}`);
          // Salta al prossimo dopo errore
          setTimeout(() => processPlayer(id + 1), 1000);
        }
      }

      processPlayer(playerId);
    }

    function stopExtraction() {
      stopRequested = true;
    }

    function resetProgress() {
      localStorage.removeItem('playerId');
      log("🔄 Progressi azzerati. Si ripartirà da ID 1.");
    }
  </script>

</body>
</html>
